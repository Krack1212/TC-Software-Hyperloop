<!DOCTYPE html>
<html>
    <head>
        <title>El Romancero</title>

        <link rel="stylesheet" type="text/css" href="Trabajo4.css" />

        <script type="text/javascript" src="Elromancero.js"></script>
    </head>

    <body id = "cuerpo">   

        <p id = "recuento">Estrofas <span id = "estrofas"></span>·Versos <span id = "versos"></span></p>

        <h1 id = "titulo"></h1>

        <pre><span id = "textaco"></span></pre>

        <input type="button" value="Cambiar poema" id="boton"/><br></br>

        <script>
            
            //Genera un num aleatorio para decidir el poema
            let numpoema = Math.floor(Math.random()*romanceroGitano.length);

            const cosa1 = document.getElementById("textaco");
            const btn = document.getElementById("boton");
            const tit = document.getElementById("titulo");
            const estr = document.getElementById("estrofas");
            const vers = document.getElementById("versos");
            const backg = document.getElementById("cuerpo");
            
            //Modifica el titulo y cuerpo dependiendo del numero generado
            cosa1.textContent = romanceroGitano[numpoema].poema;
            tit.textContent = romanceroGitano[numpoema].titulo;

            //Actualiza las estrofas
            function conteoest(){

              const estrofas = cosa1.textContent
                                  .split(/\n\s*\n/)
                                  .filter(bloque => bloque.trim() !== '')
                                  .length;
              estr.textContent = estrofas;
            }

            //Actualiza los versos
            function conteovers(){
        
              const versos = cosa1.textContent
                                .split('\n')
                                .filter(linea => linea.trim() !== '')
                                .length;
              vers.textContent = versos;
            }

            function buscatemas(){

              const texto = cosa1.textContent.toLowerCase();

              backg.classList.remove("guardiacivil","sangr","caball","cuchill");

              const randomColor = () => '#' + Math.floor(Math.random() * 16777215).toString(16);

              if (texto.includes("guardia civil")) {
                backg.classList.add("guardiacivil");
              } else if (texto.includes("sangre")) {
                backg.classList.add("sangr"); 
              } else if (texto.includes("caballo")) {
                backg.classList.add("caball");
              } else if (texto.includes("cuchillo") || texto.includes("navaja")) {
                backg.classList.add("cuchill");
              }
            }

            buscatemas();
            conteoest();
            conteovers();

            //Programación del botón que: muestra un poema y título nuevos, 
            //                            cambia el color de fondo acorde con las normas,
            //                            actualiza el contador de versos y estrofas.
            btn.addEventListener("click", () => {
                let numpoema = Math.floor(Math.random()*romanceroGitano.length);
                cosa1.textContent = romanceroGitano[numpoema].poema;
                tit.textContent = romanceroGitano[numpoema].titulo;
                buscatemas();
                conteoest();
                conteovers();
            });

        </script>       
    </body>

</html>